!function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=2)}([function(e,t){e.exports=scene},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQwIDc5LjE2MDQ1MSwgMjAxNy8wNS8wNi0wMTowODoyMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjdCQUQzOURFMTg0NTExRThBMDc0QUZGM0Y1MTQwNzhDIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjdCQUQzOURGMTg0NTExRThBMDc0QUZGM0Y1MTQwNzhDIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6N0JBRDM5REMxODQ1MTFFOEEwNzRBRkYzRjUxNDA3OEMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6N0JBRDM5REQxODQ1MTFFOEEwNzRBRkYzRjUxNDA3OEMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4KOLJ3AAABUklEQVR42mL8//8/AzUBEwOVAW0M3LJlyxkQJpeNbCAjKAyhgiZkOuqMj4+PCYqBUJsYgBIoKkFiyAAmjyyOrgfFhSBJIDsKyI4E4uVAvAzNNUZA/AmI7+ByIbZIARkmCaXRQToQe+DzP4qXoQCXC0GumwXEz4HYD4j/E/QygcCfCcTGUHYKEF/A5mUWHAEuBMTMQPwayXVgw54+fSr87Nmzld++fZMBcg+rqKgIl5aWMnR3dyMMRLYBGq4tQMwBDbPfUBps2N27d+WBvmIE+Q7kbSAf5PUEIF6AkrCRDAR5xwyI9YC4DNl1r1+/FoIaBgdQfgSGl9EMhIFAKAaDz58/80BdBo8DKP0VxUCQl5Fi2QxXrPz7928HLHZhXoayd2LkZWhsgWMNFxsYAeqMjIwo5R2UvwIjHRIDQLEJjQBQmNmCYhlq2AJYLDOOvAIWIMAAzV61w1HebFoAAAAASUVORK5CYII="},function(e,t,i){e.exports=i(3)},function(e,t,i){"use strict";i.r(t);var n=i(1),s=i.n(n),r=i(0);const o={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"connection",name:"connection"},{type:"string",label:"topic",name:"topic"},{type:"string",label:"symbol",name:"symbol"}]};class a extends(Object(r.DataSource)(Object(r.RectPath)(r.Shape))){static get image(){return a._image||(a._image=new Image,a._image.src=s.a),a._image}static get connection(){return a._connection||(a._connection=new BitMEXConnection),a._connection}async ready(){super.ready(),this.app.isViewMode&&await this._subscribe()}get connection(){var{connection:e}=this.model;if(e)return this.root.findById(e)}async _subscribe(){var{topic:e,symbol:t}=this.model;if(console.log(e,t,this.connection),this.connection&&e&&t)try{this.session=await this.connection.subscribe({op:"subscribe",args:[`${e}:${t}`]},e=>{console.log(e),this.set("data",e)})}catch(e){console.error("catched",e)}}dispose(){this.session&&this.session.dispose(),delete this.session,super.dispose()}render(e){var{left:t,top:i,width:n,height:s}=this.bounds;e.beginPath(),e.drawImage(a.image,t,i,n,s)}get nature(){return o}}r.Component.register("bitmex-quote",a);const c="wss://www.bitmex.com",h="/realtimemd",l="/realtime",d="GET",u=0,p=1,b=2;class m{constructor(){this.connection,this.sessions={},this.promise}dispose(){this.reject&&(this.reject("disposed"),delete this.reject),delete this.promise,Object.values(this.sessions).forEach(e=>{e.dispose()}),this.sessions={},delete this.websocket}connect(){return this.promise?this.promise:(this.promise=new Promise((e,t)=>{this.reject=t;try{var i=new WebSocket(c+h);i.onmessage=(e=>{var t=JSON.parse(e.data);let[i,n,s,r]=t,o=this.sessions[n];i==u?o&&o.handler&&o.handler(r):i==b&&delete this.sessions[n]}),i.onopen=(()=>{this.websocket=i,e()}),i.onclose=(e=>{this.dispose(),console.log(e)})}catch(e){console.error(e),this.dispose(),t(e)}}),this.promise)}newId(){return this.idgen||(this.idgen=0),`id-${this.idgen++}`}async newSession(){var e=this.newId(),t=e;await this.connect();var i=new g(this,e,t);this.sessions[e]=i;var n=new Promise((e,t)=>{i.promise={resolve:e,reject:t},i.handler=function(t){console.log("handler",t),delete i.handler,delete i.promise,e(i)}});return this.websocket.send(JSON.stringify([p,e,t])),n}}class g{constructor(e,t,i){this.connection=e,this.id=t,this.topic=i}dispose(){this.reject&&this.reject("session disposed"),delete this.reject}authenticate(e,t){this.authenticated=!1;let i=Date.now()+5;var n={op:"authKeyExpires",args:[e,i,function(e,t,i,n,s){var r="";s&&(r=JSON.stringify(s));var o=new URL(i),a=`${t}${o.pathname}${o.search}${n}${r}`;return crypto.createHmac("sha256",e).update(a).digest("hex")}(t,d,c+l,i)]},s=new Promise((e,t)=>{this.reject&&this.reject("authenticated"),this.reject=t,this.handler=function(i){delete this.handler,delete this.reject,i.success?e(!0):t(i)}});return this.connection.websocket.send(JSON.stringify([u,this.id,this.topic,n])),s}subscribe(e,t){this.reject&&this.reject("subscribed");var{op:i,args:n}=e;if(!i||!n)return Promise.reject("invalid payload",e);var s=new Promise((e,i)=>{this.reject=i,this.handler=(n=>{delete this.handler,delete this.reject,n.success?(this.handler=t,e(!0)):i(n)})});return this.connection.websocket.send(JSON.stringify([u,this.id,this.topic,e])),s}unsubscribe(){var e=new Promise((e,t)=>{this.reject&&this.reject("unsubscribed"),this.reject=t,this.handler=(i=>{delete this.handler,delete this.reject,i.success?e(!0):t(i)})});return this.connection.websocket.send(JSON.stringify([b,this.id,this.topic])),e}}const w=["announcement","chat","connected","funding","instrument","insurance","liquidation","orderBookL2","orderBook10","publicNotifications","quote","quoteBin1m","quoteBin5m","quoteBin1h","quoteBin1d","settlement","trade","tradeBin1m","tradeBin5m","tradeBin1h","tradeBin1d"],y=["affiliate","execution","order","margin","position","privateNotifications","transact","wallet"],A={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"api-key",name:"apiKey"},{type:"string",label:"api-secret",name:"apiSecret"}]};class f extends(Object(r.DataSource)(Object(r.RectPath)(r.Shape))){static get image(){return f._image||(f._image=new Image,f._image.src=s.a),f._image}get connection(){return this._connection||(this._connection=new m),this._connection}async connect(){return await this.connection.newSession()}async authenticate(e){var{apiKey:t,apiSecret:i}=this.model;e.authenticate(t,i)}async subscribe(e,t){var i,{args:n}=e,s=n[0].split(":")[0];if(-1!=y.indexOf(s))console.log("auth required topic",s),i=!0;else if(-1==w.indexOf(s))return void console.log("non topic",s);var r=await this.connect();return i&&await this.authenticate(r),await r.subscribe(e,t),r}async unsubscribe(e){e.unsubscribe()}dispose(){this._connection&&this._connection.dispose(),delete this._connection,super.dispose()}render(e){var{left:t,top:i,width:n,height:s}=this.bounds;e.beginPath(),e.drawImage(f.image,t,i,n,s)}get nature(){return A}}r.Component.register("bitmex-conn",f);const j={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"value",name:"value"},{type:"angle",label:"angle property",name:"propAngle"},{type:"string",label:"string property",name:"propString"},{type:"color",label:"color property",name:"propColor"}]};class v extends(Object(r.ValueHolder)(Object(r.RectPath)(r.Shape))){static get nature(){return j}dispose(){super.dispose()}render(e){var{top:t,left:i,height:n,width:s,backgroundColor:r="transparent",reverse:o}=this.model;this.animOnValueChange(this.value),e.beginPath(),e.rect(i,t,s,n),e.fillStyle=r,e.fill(),e.beginPath();var a=s-s*Math.max(Math.min(this.animValue,100),0)/100;a=Math.max(Math.min(a,s),0),e.rect(i+a,t,s-a,n),this.drawFill(e),e.closePath(),e.beginPath(),e.rect(i,t,s,n)}postrender(e){this.drawStroke(e),this.drawText(e)}get controls(){}}r.Component.register("candle-stick-chart",v);t.default=[a,f,v]}]);
//# sourceMappingURL=things-scene-bitmex.js.map