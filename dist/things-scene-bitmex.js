!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){e.exports=scene},function(e,t,n){e.exports=n(2)},function(e,t,n){"use strict";n.r(t);var r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQwIDc5LjE2MDQ1MSwgMjAxNy8wNS8wNi0wMTowODoyMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjdCQUQzOURFMTg0NTExRThBMDc0QUZGM0Y1MTQwNzhDIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjdCQUQzOURGMTg0NTExRThBMDc0QUZGM0Y1MTQwNzhDIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6N0JBRDM5REMxODQ1MTFFOEEwNzRBRkYzRjUxNDA3OEMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6N0JBRDM5REQxODQ1MTFFOEEwNzRBRkYzRjUxNDA3OEMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4KOLJ3AAABUklEQVR42mL8//8/AzUBEwOVAW0M3LJlyxkQJpeNbCAjKAyhgiZkOuqMj4+PCYqBUJsYgBIoKkFiyAAmjyyOrgfFhSBJIDsKyI4E4uVAvAzNNUZA/AmI7+ByIbZIARkmCaXRQToQe+DzP4qXoQCXC0GumwXEz4HYD4j/E/QygcCfCcTGUHYKEF/A5mUWHAEuBMTMQPwayXVgw54+fSr87Nmzld++fZMBcg+rqKgIl5aWMnR3dyMMRLYBGq4tQMwBDbPfUBps2N27d+WBvmIE+Q7kbSAf5PUEIF6AkrCRDAR5xwyI9YC4DNl1r1+/FoIaBgdQfgSGl9EMhIFAKAaDz58/80BdBo8DKP0VxUCQl5Fi2QxXrPz7928HLHZhXoayd2LkZWhsgWMNFxsYAeqMjIwo5R2UvwIjHRIDQLEJjQBQmNmCYhlq2AJYLDOOvAIWIMAAzV61w1HebFoAAAAASUVORK5CYII=",o=n(0);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n,r,o,i,c){try{var a=e[i](c),u=a.value}catch(e){return void n(e)}a.done?t(u):Promise.resolve(u).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){c(i,r,o,a,u,"next",e)}function u(e){c(i,r,o,a,u,"throw",e)}a(void 0)}))}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e,t,n){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"connection",name:"connection"},{type:"string",label:"topic",name:"topic"},{type:"string",label:"symbol",name:"symbol"}]},y=function(e){function t(){return u(this,t),l(this,p(t).apply(this,arguments))}var n,o,i,c,y;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,e),n=t,o=[{key:"ready",value:(y=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f(p(t.prototype),"ready",this).call(this),this.app.isViewMode){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this._subscribe();case 5:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"_subscribe",value:(c=a(regeneratorRuntime.mark((function e(){var t,n,r,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.model,n=t.topic,r=t.symbol,console.log(n,r,this.connection),this.connection&&n&&r){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,this.connection.subscribe({op:"subscribe",args:["".concat(n,":").concat(r)]},(function(e){console.log(e),o.set("data",e)}));case 7:this.session=e.sent,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),console.error("catched",e.t0);case 13:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(){return c.apply(this,arguments)})},{key:"dispose",value:function(){this.session&&this.session.dispose(),delete this.session,f(p(t.prototype),"dispose",this).call(this)}},{key:"render",value:function(e){var n=this.bounds,r=n.left,o=n.top,i=n.width,c=n.height;e.beginPath(),e.drawImage(t.image,r,o,i,c)}},{key:"connection",get:function(){var e=this.model.connection;if(e)return this.root.findById(e)}},{key:"nature",get:function(){return b}}],i=[{key:"image",get:function(){return t._image||(t._image=new Image,t._image.src=r),t._image}},{key:"connection",get:function(){return t._connection||(t._connection=new BitMEXConnection),t._connection}}],o&&s(n.prototype,o),i&&s(n,i),t}(Object(o.DataSource)(Object(o.RectPath)(o.Shape)));function d(e,t,n,r,o,i,c){try{var a=e[i](c),u=a.value}catch(e){return void n(e)}a.done?t(u):Promise.resolve(u).then(r,o)}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var c,a=e[Symbol.iterator]();!(r=(c=a.next()).done)&&(n.push(c.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t,n){return t&&v(e.prototype,t),n&&v(e,n),e}o.Component.register("bitmex-quote",y);var O=function(){function e(){g(this,e),this.connection,this.sessions={},this.promise}var t,n;return w(e,[{key:"dispose",value:function(){this.reject&&(this.reject("disposed"),delete this.reject),delete this.promise,Object.values(this.sessions).forEach((function(e){e.dispose()})),this.sessions={},delete this.websocket}},{key:"connect",value:function(){var e=this;return this.promise?this.promise:(this.promise=new Promise((function(t,n){e.reject=n;try{var r=new WebSocket("wss://www.bitmex.com/realtimemd");r.onmessage=function(t){var n=m(JSON.parse(t.data),4),r=n[0],o=n[1],i=(n[2],n[3]),c=e.sessions[o];0==r?c&&c.handler&&c.handler(i):2==r&&delete e.sessions[o]},r.onopen=function(){e.websocket=r,t()},r.onclose=function(t){e.dispose(),console.log(t)}}catch(t){console.error(t),e.dispose(),n(t)}})),this.promise)}},{key:"newId",value:function(){return this.idgen||(this.idgen=0),"id-".concat(this.idgen++)}},{key:"newSession",value:(t=regeneratorRuntime.mark((function e(){var t,n,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.newId(),n=t,e.next=4,this.connect();case 4:return r=new j(this,t,n),this.sessions[t]=r,o=new Promise((function(e,t){r.promise={resolve:e,reject:t},r.handler=function(t){console.log("handler",t),delete r.handler,delete r.promise,e(r)}})),this.websocket.send(JSON.stringify([1,t,n])),e.abrupt("return",o);case 9:case"end":return e.stop()}}),e,this)})),n=function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function c(e){d(i,r,o,c,a,"next",e)}function a(e){d(i,r,o,c,a,"throw",e)}c(void 0)}))},function(){return n.apply(this,arguments)})}]),e}(),j=function(){function e(t,n,r){g(this,e),this.connection=t,this.id=n,this.topic=r}return w(e,[{key:"dispose",value:function(){this.reject&&this.reject("session disposed"),delete this.reject}},{key:"authenticate",value:function(e,t){var n=this;this.authenticated=!1;var r=Date.now()+5,o={op:"authKeyExpires",args:[e,r,function(e,t,n,r,o){var i="";o&&(i=JSON.stringify(o));var c=new URL(n),a="".concat(t).concat(c.pathname).concat(c.search).concat(r).concat(i);return crypto.createHmac("sha256",e).update(a).digest("hex")}(t,"GET","wss://www.bitmex.com/realtime",r)]},i=new Promise((function(e,t){n.reject&&n.reject("authenticated"),n.reject=t,n.handler=function(n){delete this.handler,delete this.reject,n.success?e(!0):t(n)}}));return this.connection.websocket.send(JSON.stringify([0,this.id,this.topic,o])),i}},{key:"subscribe",value:function(e,t){var n=this;this.reject&&this.reject("subscribed");var r=e.op,o=e.args;if(!r||!o)return Promise.reject("invalid payload",e);var i=new Promise((function(e,r){n.reject=r,n.handler=function(o){delete n.handler,delete n.reject,o.success?(n.handler=t,e(!0)):r(o)}}));return this.connection.websocket.send(JSON.stringify([0,this.id,this.topic,e])),i}},{key:"unsubscribe",value:function(){var e=this,t=new Promise((function(t,n){e.reject&&e.reject("unsubscribed"),e.reject=n,e.handler=function(r){delete e.handler,delete e.reject,r.success?t(!0):n(r)}}));return this.connection.websocket.send(JSON.stringify([2,this.id,this.topic])),t}}]),e}();function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e,t,n,r,o,i,c){try{var a=e[i](c),u=a.value}catch(e){return void n(e)}a.done?t(u):Promise.resolve(u).then(r,o)}function R(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function c(e){A(i,r,o,c,a,"next",e)}function a(e){A(i,r,o,c,a,"throw",e)}c(void 0)}))}}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(e,t){return!t||"object"!==k(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function I(e,t,n){return(I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=M(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function B(e,t){return(B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=["announcement","chat","connected","funding","instrument","insurance","liquidation","orderBookL2","orderBook10","publicNotifications","quote","quoteBin1m","quoteBin5m","quoteBin1h","quoteBin1d","settlement","trade","tradeBin1m","tradeBin5m","tradeBin1h","tradeBin1d"],N=["affiliate","execution","order","margin","position","privateNotifications","transact","wallet"],_={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"api-key",name:"apiKey"},{type:"string",label:"api-secret",name:"apiSecret"}]},D=function(e){function t(){return S(this,t),x(this,M(t).apply(this,arguments))}var n,o,i,c,a,u,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&B(e,t)}(t,e),n=t,o=[{key:"connect",value:(s=R(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.connection.newSession();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"authenticate",value:(u=R(regeneratorRuntime.mark((function e(t){var n,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.model,r=n.apiKey,o=n.apiSecret,t.authenticate(r,o);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"subscribe",value:(a=R(regeneratorRuntime.mark((function e(t,n){var r,o,i,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.args,o=r[0].split(":")[0],-1==N.indexOf(o)){e.next=7;break}console.log("auth required topic",o),i=!0,e.next=10;break;case 7:if(-1!=E.indexOf(o)){e.next=10;break}return console.log("non topic",o),e.abrupt("return");case 10:return e.next=12,this.connect();case 12:if(c=e.sent,e.t0=i,!e.t0){e.next=17;break}return e.next=17,this.authenticate(c);case 17:return e.next=19,c.subscribe(t,n);case 19:return e.abrupt("return",c);case 20:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"unsubscribe",value:(c=R(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.unsubscribe();case 1:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"dispose",value:function(){this._connection&&this._connection.dispose(),delete this._connection,I(M(t.prototype),"dispose",this).call(this)}},{key:"render",value:function(e){var n=this.bounds,r=n.left,o=n.top,i=n.width,c=n.height;e.beginPath(),e.drawImage(t.image,r,o,i,c)}},{key:"connection",get:function(){return this._connection||(this._connection=new O),this._connection}},{key:"nature",get:function(){return _}}],i=[{key:"image",get:function(){return t._image||(t._image=new Image,t._image.src=r),t._image}}],o&&P(n.prototype,o),i&&P(n,i),t}(Object(o.DataSource)(Object(o.RectPath)(o.Shape)));function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function G(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function T(e,t,n){return(T="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=U(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Z(e,t){return(Z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}o.Component.register("bitmex-conn",D);var z={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"value",name:"value"},{type:"angle",label:"angle property",name:"propAngle"},{type:"string",label:"string property",name:"propString"},{type:"color",label:"color property",name:"propColor"}]},J=function(e){function t(){return Q(this,t),G(this,U(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Z(e,t)}(t,e),n=t,o=[{key:"nature",get:function(){return z}}],(r=[{key:"dispose",value:function(){T(U(t.prototype),"dispose",this).call(this)}},{key:"render",value:function(e){var t=this.model,n=t.top,r=t.left,o=t.height,i=t.width,c=t.backgroundColor,a=void 0===c?"transparent":c;t.reverse,this.animOnValueChange(this.value),e.beginPath(),e.rect(r,n,i,o),e.fillStyle=a,e.fill(),e.beginPath();var u=i-i*Math.max(Math.min(this.animValue,100),0)/100;u=Math.max(Math.min(u,i),0),e.rect(r+u,n,i-u,o),this.drawFill(e),e.closePath(),e.beginPath(),e.rect(r,n,i,o)}},{key:"postrender",value:function(e){this.drawStroke(e),this.drawText(e)}},{key:"controls",get:function(){}}])&&Y(n.prototype,r),o&&Y(n,o),t}(Object(o.ValueHolder)(Object(o.RectPath)(o.Shape)));o.Component.register("candle-stick-chart",J);t.default=[y,D,J]}]);
//# sourceMappingURL=things-scene-bitmex.js.map